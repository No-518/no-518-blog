---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import TagList from '../components/TagList.astro';
import { site } from '../config/site';
import { getAllCategories, getAllTags, getPublishedPosts } from '../utils/content';
import { withBase } from '../utils/url';

const posts = await getPublishedPosts();
const categories = await getAllCategories();
const tags = await getAllTags();
---

<BaseLayout>
  <section class="card">
    <p class="text-sm text-slate-500">No-518 · 研究与工程记录</p>
    <h1 class="mt-3 text-3xl font-semibold">{site.name}</h1>
    <p class="mt-3 text-slate-600 dark:text-slate-300">{site.description}</p>
    <div class="mt-4 flex flex-wrap gap-3 text-sm">
      <a class="rounded-full border border-border px-4 py-2" href={withBase('/about')}>关于我</a>
      <a class="rounded-full border border-border px-4 py-2" href={withBase('/blog')}>阅读博客</a>
      <a class="rounded-full border border-border px-4 py-2" href={withBase('/projects')}>项目清单</a>
    </div>
  </section>

  <section class="mt-10 grid gap-6 lg:grid-cols-[1fr_320px]">
    <div class="space-y-4">
      <h2 class="text-lg font-semibold">最新文章</h2>
      <div class="space-y-4">
        {posts.slice(0, 6).map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    </div>
    <aside class="space-y-6">
      <div class="card">
        <h3 class="text-sm font-semibold text-slate-600 dark:text-slate-300">分类</h3>
        <div class="mt-3 space-y-2 text-sm">
          {categories.map((category) => (
            <a class="flex items-center justify-between" href={withBase(`/blog/${category.slug}`)}>
              <span>{category.label}</span>
              <span class="text-xs text-slate-500">{category.count}</span>
            </a>
          ))}
        </div>
      </div>
      <div class="card">
        <h3 class="text-sm font-semibold text-slate-600 dark:text-slate-300">标签</h3>
        <div class="mt-3">
          <TagList tags={tags} />
        </div>
      </div>
    </aside>
  </section>
</BaseLayout>
