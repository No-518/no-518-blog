---
import Comments from '../components/Comments.astro';
import BaseLayout from './BaseLayout.astro';

const { post, Content, headings } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<BaseLayout title={post.data.title} description={post.data.description} image={post.data.cover}>
  <article class="prose dark:prose-invert max-w-none">
    <h1>{post.data.title}</h1>
    <p class="text-sm text-slate-500">
      <time datetime={post.data.pubDate.toISOString()}>
        {post.data.pubDate.toLocaleDateString('zh-CN')}
      </time>
      {post.data.updatedDate ? (
        <>
          {' '}· 更新于{' '}
          <time datetime={post.data.updatedDate.toISOString()}>
            {post.data.updatedDate.toLocaleDateString('zh-CN')}
          </time>
        </>
      ) : null}
    </p>
    <div class="my-4 flex flex-wrap gap-2">
      {post.data.tags.map((tag, index) => (
        <a
          class="rounded-full border border-border px-3 py-1 text-xs text-slate-600 hover:border-primary dark:text-slate-300"
          href={`${base}tags/${post.data.tagSlugs[index]}`}
        >
          {tag}
        </a>
      ))}
    </div>
    <div class="grid gap-6 lg:grid-cols-[minmax(0,1fr)_260px]">
      <div>
        {Content ? <Content /> : null}
      </div>
      {headings?.length ? (
        <aside class="hidden lg:block">
          <div class="card text-sm">
            <div class="font-semibold">目录</div>
            <ul class="mt-3 space-y-2">
              {headings.map((heading) => (
                <li style={`margin-left: ${heading.depth * 0.5}rem`}>
                  <a href={`#${heading.slug}`}>{heading.text}</a>
                </li>
              ))}
            </ul>
          </div>
        </aside>
      ) : null}
    </div>
  </article>
  <section class="mt-10">
    <Comments path={`/blog/${post.slug}`} />
  </section>
</BaseLayout>
